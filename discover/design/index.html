<!DOCTYPE html><html lang="en" dir="ltr"><head>
  
    <link rel="stylesheet" href="../../b1403e10.css">
  
    

  



<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>[WIP]标准化微前端容器— WebWidget 设计过程: Web Widget</title>
<meta property="og:title" content="[WIP]标准化微前端容器— WebWidget 设计过程: Web Widget">

<meta name="generator" content="rocket 0.1">
<link rel="canonical" href="http://localhost:8000/discover/design/">



<meta name="description" content="网页的小挂件技术体系。">
<meta property="og:description" content="网页的小挂件技术体系。">

  
    <link rel="apple-touch-icon" sizes="180x180" href="../../assets/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../assets/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../assets/favicon-16x16.png">
<link rel="manifest" href="../../assets/webmanifest.json">
<link rel="mask-icon" href="../../assets/safari-pinned-tab.svg" color="#3f93ce">
<meta name="msapplication-TileColor" content="#1d3557">
<meta name="theme-color" content="#1d3557">

  
    <meta property="og:site_name" content="Web Widget">
<meta property="og:type" content="website">

<meta property="og:image" content="http://localhost:8000/8467fbb1.png">
<meta property="og:url" content="http://localhost:8000/discover/design/">

<meta name="twitter:card" content="summary_large_image">

  
    <link rel="stylesheet" href="../../5f77f4be.css">
<link rel="stylesheet" href="../../490f016e.css">
<link rel="stylesheet" href="../../a0513237.css">
<link rel="stylesheet" href="../../a27aa5f7.css">

  
    <noscript><link rel="stylesheet" href="/_merged_assets/_static/noscript.css"/></noscript>

  

<link rel="preload" href="../../7260640b.js" as="script" crossorigin="anonymous">
<link rel="preload" href="../../c896c369.js" as="script" crossorigin="anonymous">
<link rel="preload" href="../../9e9e2b78.js" as="script" crossorigin="anonymous">
<link rel="preload" href="../../b0ea14e1.js" as="script" crossorigin="anonymous">
<link rel="preload" href="../../d15d5a5d.js" as="script" crossorigin="anonymous">
</head>

  

  
  <body layout="layout-sidebar">
  

    
      <header id="main-header">
  <div class="content-area">
    
      <button id="mobile-menu-trigger" data-action="trigger-mobile-menu">
	<span class="sr-only">Show Menu</span>
	      <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon">
        <path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path>
      </svg>

</button>

    
      
	<a class="logo-link" href="/">
  <img src="../../35ded306.svg" alt="O with occluded right edge to appear also as a C">
  <span>Web Widget</span>
</a>



    
      <rocket-search class="search" json-url="/_merged_assets/_static/rocket-search-index.json">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" style="width: 25px;">
    <path d="M51.6 96.7c11 0 21-3.9 28.8-10.5l35 35c.8.8 1.8 1.2 2.9 1.2s2.1-.4 2.9-1.2c1.6-1.6 1.6-4.2 0-5.8l-35-35c6.5-7.8 10.5-17.9 10.5-28.8 0-24.9-20.2-45.1-45.1-45.1-24.8 0-45.1 20.3-45.1 45.1 0 24.9 20.3 45.1 45.1 45.1zm0-82c20.4 0 36.9 16.6 36.9 36.9C88.5 72 72 88.5 51.6 88.5S14.7 71.9 14.7 51.6c0-20.3 16.6-36.9 36.9-36.9z"></path>
  </svg>
</rocket-search>



    
      
  <a href="/guides/" class="
          
          
        ">指南</a>
  <a href="/docs/" class="
          
          
        ">文档</a>

    
      <launch-dark-switch class="light-dark-switch" label="Toggle darkmode">Toggle darkmode</launch-dark-switch>


    
      
	<a class="social-link" href="https://github.com//web-widget/web-widget" aria-label="Web Widget on GitHub" rel="noopener noreferrer" target="_blank">
		<span class="sr-only">GitHub</span>
		
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 16" fill="none">
  <title>GitHub</title>
  <path fill="currentColor" fill-rule="evenodd" d="M8.18391.249268C3.82241.249268.253906 3.81777.253906 8.17927c0 3.46933 2.279874 6.44313 5.451874 7.53353.3965.0991.49563-.1983.49563-.3965v-1.3878c-2.18075.4956-2.67638-.9912-2.67638-.9912-.3965-.8922-.89212-1.1895-.89212-1.1895-.69388-.4957.09912-.4957.09912-.4957.793.0992 1.1895.793 1.1895.793.69388 1.2887 1.88338.8922 2.27988.6939.09912-.4956.29737-.8921.49562-1.0904-1.78425-.1982-3.5685-.8921-3.5685-3.96496 0-.89212.29738-1.586.793-2.08162-.09912-.19825-.3965-.99125.09913-2.08163 0 0 .69387-.19825 2.18075.793.59475-.19825 1.28862-.29737 1.9825-.29737.69387 0 1.38775.09912 1.98249.29737 1.4869-.99125 2.1808-.793 2.1808-.793.3965 1.09038.1982 1.88338.0991 2.08163.4956.59475.793 1.28862.793 2.08162 0 3.07286-1.8834 3.66766-3.66764 3.86586.29737.3965.59474.8921.59474 1.586v2.1808c0 .1982.0991.4956.5948.3965 3.172-1.0904 5.4518-4.0642 5.4518-7.53353-.0991-4.3615-3.6676-7.930002-8.02909-7.930002z" clip-rule="evenodd"></path>
</svg>

		
	</a>

    
  </div>
</header>

    

    
  <div id="content-wrapper">
    <div class="content-area">
      
        <rocket-drawer id="sidebar">
  <nav slot="content" id="sidebar-nav">
    
      <a class="logo-link" href="/">
  <img src="../../35ded306.svg" alt="O with occluded right edge to appear also as a C">
  <span>Web Widget</span>
</a>


    
      <rocket-navigation>
  
  <div class="sidebar-bottom">
  <hr>
  <launch-dark-switch class="light-dark-switch" label="Toggle darkmode">Toggle darkmode</launch-dark-switch>


  <a href="https://github.com//web-widget/web-widget/issues">Help and Feedback</a>
</div>

</rocket-navigation>

    
  </nav>
</rocket-drawer>

      
      
        <main class="markdown-body">
  
    <h1 id="wip标准化微前端容器-webwidget-设计过程"><a class="anchor" href="#wip标准化微前端容器-webwidget-设计过程"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>[WIP]标准化微前端容器— WebWidget 设计过程</h1>
<p>最近我们解决了一个前所未有的工程化挑战：在 Web 中设计一个支持可被可视化编辑编组件系统，并且允许安全运行来自用户的代码。例如通过可视化编辑器对组件的布局或者配置进行调整、运行来自 Npm 或者 GitHub 的远程代码等。</p>
<p>我们在构建一个下一代的网页可视化编辑器，我们希望能够让设计师和开发者能够分工协作：设计师是编辑器的核心用户，开发者通过组件系统为设计师提供支持可视化编排的组件。这些组件可能来自不同的技术栈实现，它们可能通过本地导入或者直接使用 CDN 加载。这个目标真正的挑战在于：这些组件不再像过去一样都经过我们内部的开发人员的精心的设计，它们很有可能无法运行甚至包含恶意代码。</p>
<p>我们的目标可以归结于两个问题：</p>
<ol>
<li>如何安全的运行代码</li>
<li>如何让组件支持可视化编排</li>
</ol>
<p>这两个问题涵盖了当今最热门的几个话题：微前端、沙箱、插件系统、NodeCode，你可以通过这篇文章的指引来设计一个接近问题本质的解决方案。</p>
<p>关于如何安全运行代码（JavaScript）这个大课题上，无论 微软、Google、Facebook、Figma 等公司都有提出过不同的解决方案，但是它们的都无法解决我们的问题：我们要提供安全且高效的 DOM 运行环境，并且最大程度的保持与真实环境的一致性。最终我们实现了一个令人激动的技术方案，我们利用 Web 中已有的标准或者实现草案构建了一个安全模型，并且通过虚拟化技术完成对资源的分配：</p>
<ul>
<li>JS 语言安全——Realm: 基于 TC39 最新草案实现</li>
<li>CSS 安全——Shadow DOM: Web 正式标准</li>
<li>HTML 安全——Sanitizer: 基于 W3C 草案实现</li>
<li>内容安全策略——CSP: 基于 W3C 正式标准实现</li>
</ul>
<p>这个可信环境实现了大部分浏览器 BOM 接口，它拥有完整的 DOM 树结构：</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-sandbox</span><span class="token punctuation">&gt;</span></span>         ——— window
  #shadow-root        ——— document
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>            ——— document.documentElement
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>   ——— document.head
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>   ——— document.body
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-sandbox</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>这项技术被称作 <code>WebSandbox</code>，它的原理更多内容可以在 <a href="https://github.com/web-sandbox-js/web-sandbox">WebSandbox.js</a> 仓库中找到，而当前文章的重点是描述第 2 个问题：如何让组件支持可视化编排。</p>
<blockquote>
<p><code>WebSandbox</code> 在筹划开源的阶段。</p>
</blockquote>
<h2 id="nocode-的组件是服务"><a class="anchor" href="#nocode-的组件是服务"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>NoCode 的组件是服务</h2>
<p>传统的 UI 组件的设计大多数是面向过程的，它们必须通过胶水代码以及特定的框架才能运行起来，这些组件 NoCode 编辑器模式下难以被直接使用。要实现 NoCode 阶段的可视化编排，组件提供的必须是开箱即用的服务，而编程接口。</p>
<p>我们考虑了很多不同的路线和方法来实现组件的服务化抽象，在数月的尝试中找到了认为接近问题本质的设计方案，其中包含四个最核心的尝试。</p>
<h2 id="尝试-1直接使用-websandbox"><a class="anchor" href="#尝试-1直接使用-websandbox"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>尝试 1：直接使用 WebSandbox</h2>
<p><code>WebSandbox</code> 为组件提供了独立的虚拟化环境，它的脚本操作都被限制在分配的视图中，它的本地存储、定时器、网络等有副作用的操作都能够被管控，移除它也会将定时器等资源进行销毁——这已经非常接近一个 iframe 的特性，它俨然是一个随时可用的微服务组件，我们似乎什么都不用做就达到了目标。</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-sandbox</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./tabs.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-sandbox</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>正因 <code>WebSandbox</code> 可以确保它不会有副作用，所以设计师可以通过编辑器把它放在任意的位置、对它的 <code>style</code> 进行设置。如果需要对组件的参数进行调节，那么可能需要增加类似 <code>postMessage()</code> 与 <code>onmessage</code>  之类的 API 以确保组件自己可以获取到配置数据。</p>
<p>经过一些探讨，我们意识到这个方案的局限：</p>
<ul>
<li>message 中可能包含事件与回调，组件需要很多胶水代码才能完成对 <code>onmessage</code>  的解析拿到数据，虽然我们可以将这个协议标准化，例如采用 JSON-RPC 等。无论如何这过于复杂，我们希望保持简单</li>
<li>为了确保我们新的组件系统足够的信心被用户采用，我们希望内部也将使用同样的机制来进行组件开发，但是内部组件要求更少的限制，这一点很像 iOS 的应用系统：官方开发的应用将有更多的权限以实现更加强大的功能，第三方的应用将运行在沙盒下以确保用户的安全。因此我们的组件系统的沙盒特性必须是可选的</li>
</ul>
<h2 id="尝试-2直接使用-single-spa"><a class="anchor" href="#尝试-2直接使用-single-spa"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>尝试 2：直接使用 single-spa</h2>
<p><a href="https://single-spa.js.org/">single-spa</a> 是一个开源的 JavaScript 的库，它较早的将后端微服务的理念引入到前端工程，即——微前端。它的成果中包含了我们想要的关键部分：</p>
<ul>
<li>将应用的概念具像化</li>
<li>应用之间独立开发、构建、部署</li>
<li>应用与技术栈无关</li>
</ul>
<p>它抽象了应用的生命周期函数，要求应用的入口文件实现对应接口：</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 初始化</span>
  <span class="token function-variable function">bootstrap</span><span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">properties</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 挂载</span>
  <span class="token function-variable function">mount</span><span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">properties</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 卸载</span>
  <span class="token function-variable function">unmount</span><span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">properties</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 移除</span>
  <span class="token function-variable function">unload</span><span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">properties</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>应用最终会按照一定顺序分别触发应用生命周期，并且传入参数完成通讯。</p>
<p>我们一开始对 single-spa  的方案抱有了较大的信心，如果完全兼容它意味着我们可以直接享受它社区给我们的资源，也能够给 single-spa 社区共享我们的力量。但是当我们深入到更多细节的时候，发现它的设计离我们可视化组件系统的预期还有一些距离。</p>
<p>single-spa 有两个大概念，一个是 Applications，另外一个是 Parcels。它们直接的区别是：Applications 内部要挂载其他 Applications 的时候，这个就是 Applications 就是 Parcels，它比 Applications 多了一个生命周期函数 <code>update()</code>，以供手动更新应用数据。</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> mountParcel <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> parcelApi <span class="token operator">=</span> <span class="token function">mountParcel</span><span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./child-app'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parcelProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>负责加载 Applications 的是 single-spa 路由系统，负责管理 Parcels 的是 Applications 生命周期里的 <code>mountParcel()</code> 函数或者 <code>mountRootParcel()</code>。加载应用的方式有如此多种，并且每一个都有很大的不同——这就是令我们非常疑惑的地方，这种疑惑也反映在 single-spa 的官方文档上，它对 Parcels  的描述非常难以理解，我们也花了足够多的时间并且通过阅读源代码才真正理解它创建的概念。</p>
<p>当抽象难以理解的时候，或许是还不够抽象。</p>
<h2 id="尝试-3创建应用容器抽象"><a class="anchor" href="#尝试-3创建应用容器抽象"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>尝试 3：创建应用容器抽象</h2>
<p>single-spa 它核心解决的问题是路由驱动的、单实例应用场景，而我们场景是多实例的。我们期望自己设计的组件系统格式能够接近最本质的东西，因此我们尝试合并Applications  与 Parcels  概念并且将路由管理从概念中剥离，拆分两个维度进行设计：</p>
<ul>
<li>应用标准格式</li>
<li>应用标准容器（或加载器）</li>
</ul>
<p>最终我们应用标准格式保持 single-spa 的定义，并且对 <code>properties</code> 默认成员进行更明确定义，删除 <code>mountParcel()</code> 以及 single-spa 注入的自身实例；应用的标准容器概念被命名为——<code>WebWidget</code>，这个名字我们借鉴了 iOS、Android 对应的概念，它的核心职责完成应用加载、初始化、挂载、更新、卸载、移除的抽象，不包括路由管理等多余的东西。</p>
<h3 id="在主文档中挂载应用"><a class="anchor" href="#在主文档中挂载应用"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>在主文档中挂载应用</h3>
<pre class="language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">WebWidget</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">,</span> <span class="token string">'./main.widget.js'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">{</span> sandboxed<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>应用的脚本被设计为 url 而非加载函数，这是为了能够通过 <code>WebSandbox</code> 来执行脚本，从而实现沙盒化。</p>
<h3 id="在应用中挂载子应用"><a class="anchor" href="#在应用中挂载子应用"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>在应用中挂载子应用</h3>
<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> container<span class="token punctuation">,</span> <span class="token maybe-class-name">WebWidget</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> userWidget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebWidget</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token string">'./users.widget.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  container<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="应用之间嵌套"><a class="anchor" href="#应用之间嵌套"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>应用之间嵌套</h3>
<p>将 <code>WebWidget</code> 作为另外一个 <code>WebWidget</code> 的容器：</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> container<span class="token punctuation">,</span> <span class="token maybe-class-name">WebWidget</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> cardWidget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebWidget</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token string">'./card.widget.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> userWidget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebWidget</span><span class="token punctuation">(</span>cardWidget<span class="token punctuation">,</span> <span class="token string">'./users.widget.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    slot<span class="token punctuation">:</span> <span class="token string">'main'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cardWidget<span class="token punctuation">.</span><span class="token method function property-access">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> userWidget<span class="token punctuation">.</span><span class="token method function property-access">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="尝试-4基于-web-components-抽象"><a class="anchor" href="#尝试-4基于-web-components-抽象"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>尝试 4：基于 Web components 抽象</h2>
<p><code>WebWidget</code> 接口提供了对应用生命周期的管理抽象，但它缺乏对视图的抽象，例如位置、尺寸等，而后者对可视化网页编辑器而言非常重要，因此我们尝试最重要的设计改进措施：采用  Web components。</p>
<p>无论是主文档还是应用、子应用内，均可以使用 HTML 标签进行声明：</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./users.widget.js<span class="token punctuation">"</span></span> <span class="token attr-name">sandboxed</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>也可以通过接口进行命令式操作：</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> widget <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'web-sandbox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
widget<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> <span class="token string">'./users.widget.js'</span><span class="token punctuation">;</span>
widget<span class="token punctuation">.</span><span class="token property-access">sandboxed</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
widget<span class="token punctuation">.</span><span class="token property-access">csp</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">script-src 'self' 'unsafe-inline' 'unsafe-eval' cdn.jsdelivr.net</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>widget<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>我们在 Web components 的到的新能力：</p>
<ul>
<li><code>&lt;web-widget&gt;</code> 标签可以被其他前端框架直接使用</li>
<li>DOM 的插入、删除能够自动触发 ``<web-widget><code> </code> 对应的生命周期</web-widget></li>
<li>Shadow DOM 可以帮助 ``<web-widget><code> </code> 隔离 CSS 污染（WebSandbox 也采用了它）</web-widget></li>
<li>基于 JavaScript 的 <code>class</code> 组织代码的方式可以让开发者扩展 ``<web-widget><code> </code> 的功能，提高灵活性</web-widget></li>
</ul>
<h3 id="在自身容器中挂载应用"><a class="anchor" href="#在自身容器中挂载应用"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>在自身容器中挂载应用</h3>
<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> container <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> userWidget <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'web-widget'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  userWidget<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> <span class="token string">'./users.widget.js'</span><span class="token punctuation">;</span>
  container<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>userWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>生成的 DOM：</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget</span><span class="token punctuation">&gt;</span></span>
  #shadow-root (closed)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./users.widget.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      #shadow-root (closed)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="应用之间嵌套-1"><a class="anchor" href="#应用之间嵌套-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>应用之间嵌套</h3>
<pre class="language-js"><code class="language-js">
<span class="token keyword">const</span> cardWidget <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'web-widget'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cardWidget<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> <span class="token string">'./card.widget.js'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> userWidget <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'web-widget'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userWidget<span class="token punctuation">.</span><span class="token property-access">slot</span> <span class="token operator">=</span> <span class="token string">'main'</span><span class="token punctuation">;</span>
userWidget<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> <span class="token string">'./user.widget.js'</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>cardWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
cardWidget<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>userWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>生成的 DOM：</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./card.widget.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  #shadow-root (closed)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./user.widget.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    #shadow-root (closed)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="权限继承与生命周期顺序"><a class="anchor" href="#权限继承与生命周期顺序"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>权限继承与生命周期顺序</h3>
<ul>
<li>父组件卸载之前会先卸载子应用、子应用创建的传送门</li>
<li>子应用会继承父应用的沙箱权限</li>
<li>DOM 的插入与删除都会触发应用生命周期函数</li>
<li>应用通过传送门挂载之前，会先卸载上一个 slot 同名的应用</li>
</ul>
<h3 id="定义传送门"><a class="anchor" href="#定义传送门"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>定义传送门</h3>
<pre class="language-js"><code class="language-js">webWidgetPortalRegistry<span class="token punctuation">.</span><span class="token method function property-access">define</span><span class="token punctuation">(</span><span class="token string">'dialog'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dialogWidget <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'web-widget'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dialogWidget<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> <span class="token string">'./dialog.widget.js'</span><span class="token punctuation">;</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>dialogWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> dialogWidget<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="应用内创建送门"><a class="anchor" href="#应用内创建送门"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>应用内创建送门</h3>
<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> container<span class="token punctuation">,</span> createPortal <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> userWidget <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'web-widget'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  userWidget<span class="token punctuation">.</span><span class="token property-access">slot</span> <span class="token operator">=</span> <span class="token string">'main'</span><span class="token punctuation">;</span>
  userWidget<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> <span class="token string">'./user.widget.js'</span><span class="token punctuation">;</span>
  <span class="token comment">// 传送应用</span>
  <span class="token keyword">const</span> cardWidget <span class="token operator">=</span> <span class="token function">createPortal</span><span class="token punctuation">(</span>userWidget<span class="token punctuation">,</span> <span class="token string">'dialog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cardWidget<span class="token punctuation">.</span><span class="token method function property-access">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>生成的 DOM：</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget</span><span class="token punctuation">&gt;</span></span>
  #shadow-root (closed)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./card.widget.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  #shadow-root (closed)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./user.widget.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    #shadow-root (closed)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h2 id="可扩展性"><a class="anchor" href="#可扩展性"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>可扩展性</h2>
<p>使用 Web components 与 实现一个自定义元素只需要将使用到 <code>class</code> 语句并且注册，类似：</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">HTMLWebWidgetElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
customElements<span class="token punctuation">.</span><span class="token method function property-access">define</span><span class="token punctuation">(</span><span class="token string">'web-widget'</span><span class="token punctuation">,</span> <span class="token maybe-class-name">HTMLWebWidgetElement</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>此章节未完成，观点：</p>
<ol>
<li>复杂问题解决方案会回到程序的设计模式</li>
</ol>
</blockquote>
<h2 id="重写元素名称"><a class="anchor" href="#重写元素名称"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>重写元素名称</h2>
<p>通过继承 <code>HTMLWebWidgetElement</code> 接口可以使用不同标签名的 WebWidget，避免使用 <code>name</code> 属性区分。</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hello-world</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./slot.widget.js<span class="token punctuation">"</span></span> <span class="token attr-name">sandboxed</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>hello wrold<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hello-world</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword module">import</span> <span class="token string">'../../src/HTMLWebWidgetElement.js'</span><span class="token punctuation">;</span>
  customElements<span class="token punctuation">.</span><span class="token method function property-access">define</span><span class="token punctuation">(</span><span class="token string">'hello-world'</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLWebWidgetElement</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h2 id="webwidget-html-模块化导入"><a class="anchor" href="#webwidget-html-模块化导入"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>WebWidget HTML 模块化导入</h2>
<p>通过继承 <code>HTMLWebWidgetElement</code> 接口如果仅仅只是重新定义标签名，那么这些需求使用标签来表达会更容易理解，就像 ECMAScript 的 <code>import</code> 语句一样。</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget.import</span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation">=</span>tagName</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span>widgetUrl</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget.import</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>这样还有一个好处是可以避免反复定义 csp 等复杂的配置：</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget.import</span>
  <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hello-world<span class="token punctuation">"</span></span>
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./slot.widget.js<span class="token punctuation">"</span></span>
  <span class="token attr-name">sandboxed</span>
  <span class="token attr-name">csp</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>
    default-src 'none';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' cdn.jsdelivr.net web-sandbox.js.org;
    style-src 'self' 'unsafe-inline' cdn.jsdelivr.net;
    navigate-to 'self' web-sandbox.js.org;
  <span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget.import</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hello-world</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>hello wrold<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hello-world</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hello-world</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>hello web-widget<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hello-world</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword module">import</span> <span class="token string">'../../src/HTMLWebWidgetElement.js'</span><span class="token punctuation">;</span>
  <span class="token keyword module">import</span> <span class="token string">'../../src/HTMLWebWidgetImportElement.js'</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>基于安全的考虑，通过 <code>&lt;web-widget.import&gt;</code> 载入的组件被设计为不允许重定义配置，例如 <code>sandboxed</code>、<code>csp</code>、<code>src</code> 等属性。</p>
<h2 id="web-components-html-模块化导入"><a class="anchor" href="#web-components-html-模块化导入"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Web components HTML 模块化导入</h2>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-component.import</span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation">=</span>tagName</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span>webComponentsUrl</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-component.import</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>它拥有和 <code>&lt;web-widget.import&gt;</code> 一样的属性，不同的是它只支持标准的 Web components 模块格式。Web components 模块无需打包成 UMD 规范，也无需遵循 WebWidget 的生命周期定义，只需要按照 Web components 的要求定义单文件组件。例如：</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// my-element.js</span>
<span class="token keyword">class</span> <span class="token class-name">MyElment</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mode<span class="token punctuation">:</span> <span class="token string">'open'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">shadowRoot</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;main&gt;&lt;slot name="main"&gt;hello wrold&lt;/slot&gt;&lt;/main&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
customElements<span class="token punctuation">.</span><span class="token method function property-access">define</span><span class="token punctuation">(</span><span class="token string">'my-element'</span><span class="token punctuation">,</span> <span class="token maybe-class-name">MyElment</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-component.import</span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slot-demo<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./my-element.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-component.import</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot-demo</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Hello Wrold<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot-demo</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword module">import</span> <span class="token string">'../../src/HTMLWebWidgetElement.js'</span><span class="token punctuation">;</span>
  <span class="token keyword module">import</span> <span class="token string">'../../src/HTMLWebWidgetImportElement.js'</span><span class="token punctuation">;</span>
  <span class="token keyword module">import</span> <span class="token string">'../../src/HTMLWebComponentImportElement.js'</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h2 id="路由驱动"><a class="anchor" href="#路由驱动"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>路由驱动</h2>
<p>通常情况下 WebWidget 会基于 DOM 的生命周期来触发应用的生命周期函数，如果给容器添加一个<code>inactive</code> 属性即可关闭与 DOM 生命周期的绑定，以便交给程序来控制它，例如前端路由库。</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>home<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./index.widget.js<span class="token punctuation">"</span></span> <span class="token attr-name">inactive</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>news<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./news.widget.js<span class="token punctuation">"</span></span> <span class="token attr-name">inactive</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-widget</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>about<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./about.widget.js<span class="token punctuation">"</span></span> <span class="token attr-name">inactive</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-widget</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword module">import</span> <span class="token string">'../../src/HTMLWebWidgetElement.js'</span><span class="token punctuation">;</span>
  <span class="token keyword module">import</span> <span class="token punctuation">{</span> register<span class="token punctuation">,</span> start <span class="token punctuation">}</span> <span class="token keyword module">from</span>  <span class="token string">'../../src/WebWidgetRouter/index.js'</span><span class="token punctuation">;</span>

  <span class="token function">register</span><span class="token punctuation">(</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#home'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token parameter"><span class="token dom variable">location</span></span> <span class="token arrow operator">=&gt;</span> <span class="token dom variable">location</span><span class="token punctuation">.</span><span class="token property-access">pathname</span> <span class="token operator">===</span> <span class="token string">'/'</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">register</span><span class="token punctuation">(</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#news'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token parameter"><span class="token dom variable">location</span></span> <span class="token arrow operator">=&gt;</span> <span class="token dom variable">location</span><span class="token punctuation">.</span><span class="token property-access">pathname</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span><span class="token string">'/news'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">register</span><span class="token punctuation">(</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#about'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token parameter"><span class="token dom variable">location</span></span> <span class="token arrow operator">=&gt;</span> <span class="token dom variable">location</span><span class="token punctuation">.</span><span class="token property-access">pathname</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h2 id="总结"><a class="anchor" href="#总结"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>总结</h2>
<h3 id="webwidget-与-single-spa-的应用主要兼容性差异"><a class="anchor" href="#webwidget-与-single-spa-的应用主要兼容性差异"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>WebWidget 与 single-spa 的应用主要兼容性差异</h3>
<ul>
<li>WebWidget 应用运行在 ShadowDOM 中</li>
<li>WebWidget 应用没有 <code>mountParcel()</code> 方法</li>
<li>WebWidget 应用没有名为 <code>singleSpa</code> 的接口</li>
<li>single-spa 在卸载应用的时候，子应用异常会被忽略，而 WebWidget 不会忽略错误</li>
<li>WebWidget 增加了传送门概念，应用可使用 <code>createPortal()</code> 方法</li>
</ul>
<h3 id="我们得到了什么"><a class="anchor" href="#我们得到了什么"><svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>我们得到了什么</h3>
<ul>
<li>组件即应用的编程模型</li>
<li>基于远程、异步载入，即插即用，无需通过源代码构建</li>
<li>让第三方未知组件的权限可控、可信任</li>
<li>易于进行 SEO 优化</li>
<li>易于进行性能优化，例如自动实施懒加载与优先加载</li>
<li>可被组合，被扩展形成新的解决方案。例如通过配合路由库创建企业级业务微前端架构</li>
<li>得到一个接近理想的 Web components 模块导入方案</li>
</ul>
<blockquote>
<p>TODO</p>
<ol>
<li>阐述为什么不是以 HTML 作为入口</li>
<li>阐述为什么是使用生命周期接口，而不是全局对象</li>
</ol>
</blockquote>

  
    <div class="content-footer">
  <p>
    发现错误或想为文档做出贡献？
    <a href="https://github.com//web-widget/web-widget/edit/master/./docs/discover/design.md">在 GitHub 上编辑此页面！</a>
  </p>
</div>

  
</main>

      
    </div>
  </div>


    
      <footer id="main-footer">
  
    

  
    <div id="footer-menu">
  <div class="content-area">
    
      <nav>
        <h3>Discover</h3>
        <ul>
          
            <li>
              <a href="/discover/about/">关于</a>
            </li>
          
            <li>
              <a href="https://github.com/web-widget/web-widget/issues">帮助与反馈</a>
            </li>
          
        </ul>
      </nav>
    
      <nav>
        <h3>Follow</h3>
        <ul>
          
            <li>
              <a href="https://github.com/web-widget/web-widget">GitHub</a>
            </li>
          
        </ul>
      </nav>
    
      <nav>
        <h3>Support</h3>
        <ul>
          
            <li>
              <a href="https://github.com/web-widget/web-widget/blob/master/CONTRIBUTING.md">Contribute</a>
            </li>
          
        </ul>
      </nav>
    
  </div>
</div>

  
</footer>

    

    
  


  <script>
  window.__rocketServiceWorkerUrl = '/service-worker.js';
</script>




  
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-131782693-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-131782693-1');
  </script>




  


<script type="module" src="../../7260640b.js"></script>
<script type="module" src="../../b0ea14e1.js"></script>
<script type="module" src="../../d15d5a5d.js" inject-service-worker=""></script>

</body></html>